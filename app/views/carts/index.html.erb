<p id="notice"><%= notice %></p>

<div class="row">
  <h1><%= current_user.name %>'s Cart</h1>
</div>

<% if @carts.empty? %>

<div class="row">
  <h2>カートには何も入っていません</h2>
</div>

<% else %>

<div class="row">
<div class="col-md-10">
  <p>Cart Model</p>
  <table>
  <thead>
    <tr>
      <th>No　</th>
      <th>Envelope_image　</th>
      <th>Envelope_name　<br />code</th>
      <th>Card_image　</th>
      <th>Card_name　<br />code</th></th>
      <th>Price　</th>
      <th colspan="2">Count　</th>
      <th>Amount　</th>
      <th>Destroy　</th>
      <th>追加日時</th>
    </tr>
  </thead>
  <tbody>
    <% @carts.each_with_index do |cart,i| %>
      <tr>
        <td><%= "#{h(i + 1)}" %></td>
        
        <% cart.products.each do |product| %>
          <td>
          <div class="cart-box">
          <% if product.main_image.present? %>
            <%= image_tag(product.main_image) %>
          <% else %>
            <%= image_tag("no-image-card.png") %>
          <% end %>
          </div>
          </td>
          <td><%= product.name %><br /><%= product.product_code %></td>
        <% end %>
        
        <td>360</td>
        <% cart.line_items.first(1).each do |li| %>
          <td><b><%= li.count %></b><br />
          <td><%= link_to '▲', update_count_up_line_item_path(li), method: :patch %><br /><%= link_to '▼', update_count_down_line_item_path(li), method: :patch %></td>
        <% end %>
        <td><%= cart.amount %>　</td>  
        <td><%= link_to '削除', cart, method: :delete, data: { confirm: '本当にカートから削除してよろしいですか？' } %></td>
        <td><%= cart.created_at.strftime('%Y/%m/%d %H:%M') %></td>
      </tr>
    <% end %>
  </tbody>
  </table>
</div>


<div class="col-md-2">  
  <h4>合計金額<%= @add_amount %>円</h4>
  
  <%= form_tag(controller: "orders", method: "post") do %>
    <%= submit_tag ("この内容で購入する"), class: 'btn btn-large btn-secondary' %>
  <% end %>
</div>

</div>

<% end %>